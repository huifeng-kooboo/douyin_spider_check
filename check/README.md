# 视频重复检测工具

这个工具可以帮助检测当前项目目录下所有MP4视频文件中是否存在内容重复的视频。如果两个视频的画面内容相似度超过90%，则会被判定为重复视频。

## 功能

- 自动遍历当前项目中所有的.mp4文件
- 比较视频内容，查找重复视频
- 将重复视频信息保存到`repeat.csv`文件中
- CSV文件包含视频名称和抖音下载链接(https://douyin.com/?modal_id=视频名称)
- 支持多进程并行处理，提高大量视频的处理速度
- 智能缓存功能，避免重复计算
- 两阶段比较策略，极大加速检测过程

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本使用

1. 将需要检测的MP4视频文件放在项目目录或其子目录中
2. 运行以下命令：

```bash
python video_duplicate_detector.py
```

3. 程序会自动检测视频并生成`repeat.csv`结果文件

### 高级选项

您可以通过命令行参数调整程序的行为：

```bash
# 自定义相似度阈值(范围0-1)
python video_duplicate_detector.py --threshold 0.85

# 指定使用的进程数量
python video_duplicate_detector.py --processes 8

# 同时指定两个参数
python video_duplicate_detector.py --threshold 0.85 --processes 8

# 清理过期的视频签名缓存
python video_duplicate_detector.py --clean-cache
```

## 工作原理

1. 程序会从每个视频中提取关键帧（最多20帧）
2. 计算每个帧的感知哈希值
3. 使用两阶段比较策略：先快速粗筛，再精确比对
4. 如果两个视频的相似度超过阈值(默认90%)，则判定为重复视频
5. 使用多进程并行计算视频特征，加速处理大量视频
6. 将视频签名缓存到本地，避免重复计算

## 性能优化亮点

- **多进程并行**：使用进程池而非线程池，突破Python GIL限制，获得真正的并行计算能力
- **智能缓存**：计算过的视频签名会被缓存下来，大大加快下次的检测速度
- **两阶段比较**：先快速粗筛，再精确比对，避免无谓的详细比较
- **优化采样**：每个视频只采样有限数量的关键帧，减少计算量
- **降低分辨率**：降低帧处理分辨率，提高计算速度
- **智能索引**：优化视频比较策略，避免重复比较

## 针对大规模视频的建议

- 对于3000+视频的大规模处理，建议先运行一次生成缓存
- 后续运行将显著提速，因为已缓存的视频无需重新分析
- 处理器核心数较多的机器将获得更好的性能
- 如果内存资源有限，可适当降低进程数量（如`--processes 4`）

## 注意事项

- 视频检测过程可能需要较长时间，特别是首次运行时
- 建议在处理大量视频前先进行小规模测试
- 过期的缓存文件（7天未使用）可通过`--clean-cache`参数清理
- 对于极大规模的视频库，可考虑分批处理 