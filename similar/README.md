# 抖音视频相似度检测工具

这个工具用于扫描当前文件夹下的所有MP4文件，找到内容相似度高的视频文件（默认相似度阈值为90%），并将结果保存到CSV文件中。

## 功能特点

- 遍历当前目录及其子目录中的所有MP4文件
- 使用视频帧采样和混合哈希算法对视频内容进行相似度分析
- 多线程处理加速分析过程
- 可调节相似度阈值（默认90%），检测高相似度视频
- 确保处理所有视频文件（不采样）
- 将相似视频分组，并生成包含视频ID和链接的CSV报告
- 根据文件创建时间识别原视频和重复视频
- 支持抖音视频链接格式：https://douyin.com/?modal_id={视频id}

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

基础用法（使用默认90%相似度阈值）：

```bash
python find_similar_videos.py
```

自定义相似度阈值：

```bash
# 使用95%的相似度阈值
python find_similar_videos.py --similarity 95.0

# 使用较低的相似度阈值（85%）找出更多可能相似的视频
python find_similar_videos.py --similarity 85.0
```

自定义输出文件名：

```bash
python find_similar_videos.py --output my_result.csv
```

同时指定相似度阈值和输出文件名：

```bash
python find_similar_videos.py --similarity 92.5 --output high_similarity_videos.csv
```

## 工作原理

1. 从每个视频中均匀采样10帧图像
2. 对每帧图像计算混合哈希（结合了平均哈希aHash和感知哈希pHash）
3. 使用汉明距离计算每一帧的相似度
4. 计算所有采样帧的平均相似度作为视频的整体相似度
5. 比较视频分辨率等基本参数，确保相似视频具有基本的一致性
6. 将相似度超过阈值（默认90%）的视频归为一组
7. 基于文件创建时间对每组视频排序，最早创建的视频被视为原视频

## 相似度计算方法

该工具采用多级相似度计算方法：

1. **视频参数检查**：首先比较视频的基本参数（如分辨率），如果这些参数不匹配，直接判定为不相似
2. **帧级相似度计算**：
   - 对每帧图像计算平均哈希(aHash)和感知哈希(pHash)
   - 使用汉明距离计算每对哈希之间的相似度
   - 相似度 = (相同位数 / 总位数) × 100%
3. **视频级相似度计算**：
   - 计算所有采样帧的平均相似度作为整体相似度
   - 当平均相似度超过阈值时，判定两个视频相似

## CSV文件格式

生成的CSV文件包含以下列：

- 组ID：相似视频的分组编号
- 视频类型：标识视频是"原视频"还是"重复视频"（基于文件创建时间）
- 文件名：视频文件名
- 视频ID：从文件名中提取的视频ID
- 视频链接：基于视频ID生成的抖音链接
- 哈希值：视频内容的特征哈希值 